{"version":3,"file":"performance.js","sources":["../../src/performance.ts"],"sourcesContent":["import { SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN } from '@sentry/browser';\nimport type { Span } from '@sentry/core';\nimport { debug, startInactiveSpan } from '@sentry/core';\nimport { afterUpdate, beforeUpdate, onMount } from 'svelte';\nimport { DEBUG_BUILD } from './debug_build';\nimport type { TrackComponentOptions } from './types';\n\nconst defaultTrackComponentOptions: {\n  trackInit: boolean;\n  trackUpdates: boolean;\n  componentName?: string;\n} = {\n  trackInit: true,\n  trackUpdates: false,\n};\n\n/**\n * Tracks the Svelte component's initialization and mounting operation as well as\n * updates and records them as spans.\n *\n * This function is injected automatically into your Svelte components' code\n * if you are using the withSentryConfig wrapper.\n *\n * Alternatively, you can call it yourself if you don't want to use the preprocessor.\n */\nexport function trackComponent(options?: TrackComponentOptions): void {\n  const mergedOptions = { ...defaultTrackComponentOptions, ...options };\n\n  const customComponentName = mergedOptions.componentName;\n\n  const componentName = `<${customComponentName || 'Svelte Component'}>`;\n\n  if (mergedOptions.trackInit) {\n    recordInitSpan(componentName);\n  }\n\n  if (mergedOptions.trackUpdates) {\n    try {\n      recordUpdateSpans(componentName);\n    } catch {\n      DEBUG_BUILD &&\n        debug.warn(\n          \"Cannot track component updates. This is likely because you're using Svelte 5 in Runes mode. Set `trackUpdates: false` in `withSentryConfig` or `trackComponent` to disable this warning.\",\n        );\n    }\n  }\n}\n\nfunction recordInitSpan(componentName: string): void {\n  const initSpan = startInactiveSpan({\n    onlyIfParent: true,\n    op: 'ui.svelte.init',\n    name: componentName,\n    attributes: { [SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: 'auto.ui.svelte' },\n  });\n\n  onMount(() => {\n    initSpan.end();\n  });\n}\n\nfunction recordUpdateSpans(componentName: string): void {\n  let updateSpan: Span | undefined;\n  beforeUpdate(() => {\n    updateSpan = startInactiveSpan({\n      onlyIfParent: true,\n      op: 'ui.svelte.update',\n      name: componentName,\n      attributes: { [SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: 'auto.ui.svelte' },\n    });\n  });\n\n  afterUpdate(() => {\n    if (!updateSpan) {\n      return;\n    }\n    updateSpan.end();\n    updateSpan = undefined;\n  });\n}\n"],"names":["DEBUG_BUILD","debug","startInactiveSpan","SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN","onMount","beforeUpdate","afterUpdate"],"mappings":";;;;;;;AAOA,MAAM;;AAIN,GAAI;AACJ,EAAE,SAAS,EAAE,IAAI;AACjB,EAAE,YAAY,EAAE,KAAK;AACrB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,cAAc,CAAC,OAAO,EAAgC;AACtE,EAAE,MAAM,gBAAgB,EAAE,GAAG,4BAA4B,EAAE,GAAG,OAAA,EAAS;;AAEvE,EAAE,MAAM,mBAAA,GAAsB,aAAa,CAAC,aAAa;;AAEzD,EAAE,MAAM,aAAA,GAAgB,CAAC,CAAC,EAAE,mBAAA,IAAuB,kBAAkB,CAAC,CAAC,CAAC;;AAExE,EAAE,IAAI,aAAa,CAAC,SAAS,EAAE;AAC/B,IAAI,cAAc,CAAC,aAAa,CAAC;AACjC;;AAEA,EAAE,IAAI,aAAa,CAAC,YAAY,EAAE;AAClC,IAAI,IAAI;AACR,MAAM,iBAAiB,CAAC,aAAa,CAAC;AACtC,MAAM,MAAM;AACZ,MAAMA,uBAAA;AACN,QAAQC,UAAK,CAAC,IAAI;AAClB,UAAU,0LAA0L;AACpM,SAAS;AACT;AACA;AACA;;AAEA,SAAS,cAAc,CAAC,aAAa,EAAgB;AACrD,EAAE,MAAM,QAAA,GAAWC,sBAAiB,CAAC;AACrC,IAAI,YAAY,EAAE,IAAI;AACtB,IAAI,EAAE,EAAE,gBAAgB;AACxB,IAAI,IAAI,EAAE,aAAa;AACvB,IAAI,UAAU,EAAE,EAAE,CAACC,wCAAgC,GAAG,kBAAkB;AACxE,GAAG,CAAC;;AAEJ,EAAEC,cAAO,CAAC,MAAM;AAChB,IAAI,QAAQ,CAAC,GAAG,EAAE;AAClB,GAAG,CAAC;AACJ;;AAEA,SAAS,iBAAiB,CAAC,aAAa,EAAgB;AACxD,EAAE,IAAI,UAAU;AAChB,EAAEC,mBAAY,CAAC,MAAM;AACrB,IAAI,UAAA,GAAaH,sBAAiB,CAAC;AACnC,MAAM,YAAY,EAAE,IAAI;AACxB,MAAM,EAAE,EAAE,kBAAkB;AAC5B,MAAM,IAAI,EAAE,aAAa;AACzB,MAAM,UAAU,EAAE,EAAE,CAACC,wCAAgC,GAAG,kBAAkB;AAC1E,KAAK,CAAC;AACN,GAAG,CAAC;;AAEJ,EAAEG,kBAAW,CAAC,MAAM;AACpB,IAAI,IAAI,CAAC,UAAU,EAAE;AACrB,MAAM;AACN;AACA,IAAI,UAAU,CAAC,GAAG,EAAE;AACpB,IAAI,UAAA,GAAa,SAAS;AAC1B,GAAG,CAAC;AACJ;;;;"}