{"version":3,"file":"config.js","sources":["../../src/config.ts"],"sourcesContent":["import type { PreprocessorGroup } from 'svelte/types/compiler/preprocess';\nimport { componentTrackingPreprocessor, defaultComponentTrackingOptions } from './preprocessors';\nimport type { SentryPreprocessorGroup, SentrySvelteConfigOptions, SvelteConfig } from './types';\n\nconst defaultSentryOptions: SentrySvelteConfigOptions = {\n  componentTracking: defaultComponentTrackingOptions,\n};\n\n/**\n * Add Sentry options to the Svelte config to be exported from the user's `svelte.config.js` file.\n *\n * @param originalConfig The existing config to be exported prior to adding Sentry\n * @param sentryOptions The configuration of the Sentry-added options\n *\n * @return The wrapped and modified config to be exported\n */\nexport function withSentryConfig(\n  originalConfig: SvelteConfig,\n  sentryOptions?: SentrySvelteConfigOptions,\n): SvelteConfig {\n  const mergedOptions = {\n    ...defaultSentryOptions,\n    ...sentryOptions,\n    componentTracking: {\n      ...defaultSentryOptions.componentTracking,\n      ...sentryOptions?.componentTracking,\n    },\n  };\n\n  const originalPreprocessors = getOriginalPreprocessorArray(originalConfig);\n\n  // Bail if users already added the preprocessor\n  if (originalPreprocessors.find((p: PreprocessorGroup) => !!(p as SentryPreprocessorGroup).sentryId)) {\n    return originalConfig;\n  }\n\n  const mergedPreprocessors = [...originalPreprocessors];\n  if (mergedOptions.componentTracking.trackComponents) {\n    mergedPreprocessors.unshift(componentTrackingPreprocessor(mergedOptions.componentTracking));\n  }\n\n  return {\n    ...originalConfig,\n    preprocess: mergedPreprocessors,\n  };\n}\n\n/**\n * Standardizes the different ways the user-provided preprocessor option can be specified.\n * Users can specify an array of preprocessors, a single one or no preprocessor.\n *\n * @param originalConfig the user-provided svelte config oject\n * @return an array of preprocessors or an empty array if no preprocessors were specified\n */\nfunction getOriginalPreprocessorArray(originalConfig: SvelteConfig): PreprocessorGroup[] {\n  if (originalConfig.preprocess) {\n    if (Array.isArray(originalConfig.preprocess)) {\n      return originalConfig.preprocess;\n    }\n    return [originalConfig.preprocess];\n  }\n  return [];\n}\n"],"names":[],"mappings":";;AAIA,MAAM,oBAAoB,GAA8B;AACxD,EAAE,iBAAiB,EAAE,+BAA+B;AACpD,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,gBAAgB;AAChC,EAAE,cAAc;AAChB,EAAE,aAAa;AACf,EAAgB;AAChB,EAAE,MAAM,gBAAgB;AACxB,IACI,GAAG,aAAa;AACpB,IAAI,iBAAiB,EAAE;AACvB,MAAM,GAAG,oBAAoB,CAAC,iBAAiB;AAC/C,MAAM,GAAG,aAAa,EAAE,iBAAiB;AACzC,KAAK;AACL,GAAG;;AAEH,EAAE,MAAM,qBAAA,GAAwB,4BAA4B,CAAC,cAAc,CAAC;;AAE5E;AACA,EAAE,IAAI,qBAAqB,CAAC,IAAI,CAAC,CAAC,CAAC,KAAwB,CAAC,CAAC,CAAC,CAAA,GAA8B,QAAQ,CAAC,EAAE;AACvG,IAAI,OAAO,cAAc;AACzB;;AAEA,EAAE,MAAM,mBAAA,GAAsB,CAAC,GAAG,qBAAqB,CAAC;AACxD,EAAE,IAAI,aAAa,CAAC,iBAAiB,CAAC,eAAe,EAAE;AACvD,IAAI,mBAAmB,CAAC,OAAO,CAAC,6BAA6B,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;AAC/F;;AAEA,EAAE,OAAO;AACT,IAAI,GAAG,cAAc;AACrB,IAAI,UAAU,EAAE,mBAAmB;AACnC,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,4BAA4B,CAAC,cAAc,EAAqC;AACzF,EAAE,IAAI,cAAc,CAAC,UAAU,EAAE;AACjC,IAAI,IAAI,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;AAClD,MAAM,OAAO,cAAc,CAAC,UAAU;AACtC;AACA,IAAI,OAAO,CAAC,cAAc,CAAC,UAAU,CAAC;AACtC;AACA,EAAE,OAAO,EAAE;AACX;;;;"}