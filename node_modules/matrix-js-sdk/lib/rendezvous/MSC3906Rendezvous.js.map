{"version":3,"file":"MSC3906Rendezvous.js","names":["_matrixEventsSdk","require","_","_client","_feature","_logger","_utils","_cryptoApi","PayloadType","Outcome","LOGIN_TOKEN_PROTOCOL","UnstableValue","MSC3906Rendezvous","constructor","channel","client","onFailure","_defineProperty2","default","RendezvousIntent","RECIPROCATE_LOGIN_ON_EXISTING_DEVICE","code","_code","generateCode","JSON","stringify","ourIntent","startAfterShowingCode","checksum","connect","logger","info","capabilities","getCapabilities","features","buildFeatureSupportMap","getVersions","capability","GET_LOGIN_TOKEN_CAPABILITY","findIn","enabled","get","Feature","LoginTokenRequest","ServerSupport","Unsupported","send","type","Finish","outcome","cancel","RendezvousFailureReason","HomeserverLacksSupport","undefined","Progress","protocols","name","protocol","receive","UnsupportedAlgorithm","Unknown","matches","payload","declineLoginOnExistingDevice","Declined","approveLoginOnExistingDevice","loginToken","login_token","homeserver","baseUrl","res","device_id","deviceId","device_key","deviceKey","Error","newDeviceId","newDeviceKey","verifyAndCrossSignDevice","deviceInfo","_await$crypto$getCros","crypto","getCrypto","getFingerprint","userId","getSafeUserId","setDeviceVerified","crossSignDevice","masterPublicKey","getCrossSigningKeyId","CrossSigningKey","Master","ourDeviceId","getDeviceId","ourDeviceKey","getOwnDeviceKeys","ed25519","Verified","verifying_device_id","verifying_device_key","master_key","verifyNewDeviceOnExistingDevice","timeout","getOwnDevice","sleep","_ownDeviceInfo$get","ownDeviceInfo","getUserDeviceInfo","reason","_this$onFailure","call","close","exports"],"sources":["../../src/rendezvous/MSC3906Rendezvous.ts"],"sourcesContent":["/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { UnstableValue } from \"matrix-events-sdk\";\n\nimport { RendezvousChannel, RendezvousFailureListener, RendezvousFailureReason, RendezvousIntent } from \".\";\nimport { IGetLoginTokenCapability, MatrixClient, GET_LOGIN_TOKEN_CAPABILITY } from \"../client\";\nimport { buildFeatureSupportMap, Feature, ServerSupport } from \"../feature\";\nimport { logger } from \"../logger\";\nimport { sleep } from \"../utils\";\nimport { CrossSigningKey } from \"../crypto-api\";\nimport { Device } from \"../matrix\";\n\nenum PayloadType {\n    Start = \"m.login.start\",\n    Finish = \"m.login.finish\",\n    Progress = \"m.login.progress\",\n}\n\nenum Outcome {\n    Success = \"success\",\n    Failure = \"failure\",\n    Verified = \"verified\",\n    Declined = \"declined\",\n    Unsupported = \"unsupported\",\n}\n\nexport interface MSC3906RendezvousPayload {\n    type: PayloadType;\n    intent?: RendezvousIntent;\n    outcome?: Outcome;\n    device_id?: string;\n    device_key?: string;\n    verifying_device_id?: string;\n    verifying_device_key?: string;\n    master_key?: string;\n    protocols?: string[];\n    protocol?: string;\n    login_token?: string;\n    homeserver?: string;\n}\n\nconst LOGIN_TOKEN_PROTOCOL = new UnstableValue(\"login_token\", \"org.matrix.msc3906.login_token\");\n\n/**\n * Implements MSC3906 to allow a user to sign in on a new device using QR code.\n * This implementation only supports generating a QR code on a device that is already signed in.\n * Note that this is UNSTABLE and may have breaking changes without notice.\n */\nexport class MSC3906Rendezvous {\n    private newDeviceId?: string;\n    private newDeviceKey?: string;\n    private ourIntent: RendezvousIntent = RendezvousIntent.RECIPROCATE_LOGIN_ON_EXISTING_DEVICE;\n    private _code?: string;\n\n    /**\n     * @param channel - The secure channel used for communication\n     * @param client - The Matrix client in used on the device already logged in\n     * @param onFailure - Callback for when the rendezvous fails\n     */\n    public constructor(\n        private channel: RendezvousChannel<MSC3906RendezvousPayload>,\n        private client: MatrixClient,\n        public onFailure?: RendezvousFailureListener,\n    ) {}\n\n    /**\n     * Returns the code representing the rendezvous suitable for rendering in a QR code or undefined if not generated yet.\n     */\n    public get code(): string | undefined {\n        return this._code;\n    }\n\n    /**\n     * Generate the code including doing partial set up of the channel where required.\n     */\n    public async generateCode(): Promise<void> {\n        if (this._code) {\n            return;\n        }\n\n        this._code = JSON.stringify(await this.channel.generateCode(this.ourIntent));\n    }\n\n    public async startAfterShowingCode(): Promise<string | undefined> {\n        const checksum = await this.channel.connect();\n\n        logger.info(`Connected to secure channel with checksum: ${checksum} our intent is ${this.ourIntent}`);\n\n        // in stable and unstable r1 the availability is exposed as a capability\n        const capabilities = await this.client.getCapabilities();\n        // in r0 of MSC3882 the availability is exposed as a feature flag\n        const features = await buildFeatureSupportMap(await this.client.getVersions());\n        const capability = GET_LOGIN_TOKEN_CAPABILITY.findIn<IGetLoginTokenCapability>(capabilities);\n\n        // determine available protocols\n        if (!capability?.enabled && features.get(Feature.LoginTokenRequest) === ServerSupport.Unsupported) {\n            logger.info(\"Server doesn't support get_login_token\");\n            await this.send({ type: PayloadType.Finish, outcome: Outcome.Unsupported });\n            await this.cancel(RendezvousFailureReason.HomeserverLacksSupport);\n            return undefined;\n        }\n\n        await this.send({ type: PayloadType.Progress, protocols: [LOGIN_TOKEN_PROTOCOL.name] });\n\n        logger.info(\"Waiting for other device to choose protocol\");\n        const { type, protocol, outcome } = await this.receive();\n\n        if (type === PayloadType.Finish) {\n            // new device decided not to complete\n            switch (outcome ?? \"\") {\n                case \"unsupported\":\n                    await this.cancel(RendezvousFailureReason.UnsupportedAlgorithm);\n                    break;\n                default:\n                    await this.cancel(RendezvousFailureReason.Unknown);\n            }\n            return undefined;\n        }\n\n        if (type !== PayloadType.Progress) {\n            await this.cancel(RendezvousFailureReason.Unknown);\n            return undefined;\n        }\n\n        if (!protocol || !LOGIN_TOKEN_PROTOCOL.matches(protocol)) {\n            await this.cancel(RendezvousFailureReason.UnsupportedAlgorithm);\n            return undefined;\n        }\n\n        return checksum;\n    }\n\n    private async receive(): Promise<MSC3906RendezvousPayload> {\n        return (await this.channel.receive()) as MSC3906RendezvousPayload;\n    }\n\n    private async send(payload: MSC3906RendezvousPayload): Promise<void> {\n        await this.channel.send(payload);\n    }\n\n    public async declineLoginOnExistingDevice(): Promise<void> {\n        logger.info(\"User declined sign in\");\n        await this.send({ type: PayloadType.Finish, outcome: Outcome.Declined });\n    }\n\n    public async approveLoginOnExistingDevice(loginToken: string): Promise<string | undefined> {\n        // eslint-disable-next-line camelcase\n        await this.send({ type: PayloadType.Progress, login_token: loginToken, homeserver: this.client.baseUrl });\n\n        logger.info(\"Waiting for outcome\");\n        const res = await this.receive();\n        if (!res) {\n            return undefined;\n        }\n        const { outcome, device_id: deviceId, device_key: deviceKey } = res;\n\n        if (outcome !== \"success\") {\n            throw new Error(\"Linking failed\");\n        }\n\n        this.newDeviceId = deviceId;\n        this.newDeviceKey = deviceKey;\n\n        return deviceId;\n    }\n\n    private async verifyAndCrossSignDevice(deviceInfo: Device): Promise<void> {\n        const crypto = this.client.getCrypto()!;\n\n        if (!this.newDeviceId) {\n            throw new Error(\"No new device ID set\");\n        }\n\n        // check that keys received from the server for the new device match those received from the device itself\n        if (deviceInfo.getFingerprint() !== this.newDeviceKey) {\n            throw new Error(\n                `New device has different keys than expected: ${this.newDeviceKey} vs ${deviceInfo.getFingerprint()}`,\n            );\n        }\n\n        const userId = this.client.getSafeUserId();\n\n        // mark the device as verified locally + cross sign\n        logger.info(`Marking device ${this.newDeviceId} as verified`);\n        await crypto.setDeviceVerified(userId, this.newDeviceId, true);\n        await crypto.crossSignDevice(this.newDeviceId);\n\n        const masterPublicKey = (await crypto.getCrossSigningKeyId(CrossSigningKey.Master)) ?? undefined;\n\n        const ourDeviceId = this.client.getDeviceId()!;\n        const ourDeviceKey = (await crypto.getOwnDeviceKeys()).ed25519;\n\n        await this.send({\n            type: PayloadType.Finish,\n            outcome: Outcome.Verified,\n            verifying_device_id: ourDeviceId,\n            verifying_device_key: ourDeviceKey,\n            master_key: masterPublicKey,\n        });\n    }\n\n    /**\n     * Verify the device and cross-sign it.\n     * @param timeout - time in milliseconds to wait for device to come online\n     */\n    public async verifyNewDeviceOnExistingDevice(timeout = 10 * 1000): Promise<void> {\n        if (!this.newDeviceId) {\n            throw new Error(\"No new device to sign\");\n        }\n\n        if (!this.newDeviceKey) {\n            logger.info(\"No new device key to sign\");\n            return undefined;\n        }\n\n        const crypto = this.client.getCrypto();\n        if (!crypto) {\n            throw new Error(\"Crypto not available on client\");\n        }\n\n        let deviceInfo = await this.getOwnDevice(this.newDeviceId);\n\n        if (!deviceInfo) {\n            logger.info(\"Going to wait for new device to be online\");\n            await sleep(timeout);\n            deviceInfo = await this.getOwnDevice(this.newDeviceId);\n        }\n\n        if (deviceInfo) {\n            await this.verifyAndCrossSignDevice(deviceInfo);\n            return;\n        }\n\n        throw new Error(\"Device not online within timeout\");\n    }\n\n    private async getOwnDevice(deviceId: string): Promise<Device | undefined> {\n        const userId = this.client.getSafeUserId();\n        const ownDeviceInfo = await this.client.getCrypto()!.getUserDeviceInfo([userId]);\n        return ownDeviceInfo.get(userId)?.get(deviceId);\n    }\n\n    public async cancel(reason: RendezvousFailureReason): Promise<void> {\n        this.onFailure?.(reason);\n        await this.channel.cancel(reason);\n    }\n\n    public async close(): Promise<void> {\n        await this.channel.close();\n    }\n}\n"],"mappings":"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","ignoreList":[]}